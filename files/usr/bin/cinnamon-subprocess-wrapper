#!/usr/bin/python3

""" Runs a command and then passes the output to Cinnamon via DBus asynchronously

Usage:  cinnamon-subprocess-wrapper ls ~/
"""

import subprocess
import sys
import dbus

if __name__ == "__main__":
    process_id = int(sys.argv[1])

    try:
        result = subprocess.check_output(sys.argv[2:])
        status = 0
    except subprocess.CalledProcessError as e:
        result = e.output
        status = e.returncode
    except FileNotFoundError:
        result = ""
        status = 1

    session_bus = dbus.SessionBus()
    dbus = session_bus.get_object("org.Cinnamon", "/org/Cinnamon")
    PushSubprocessResult = dbus.get_dbus_method('PushSubprocessResult', 'org.Cinnamon')
    PushSubprocessResult(process_id, result, status)
